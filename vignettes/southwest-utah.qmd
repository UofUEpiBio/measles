---
title: "Mixing model in Southwest Utah"
author: "George G. Vega Yon, Ph.D."
date: today
vignette: >
  %\VignetteIndexEntry{Mixing model in Southwest Utah}
  %\VignetteEngine{quarto::format}
  %\VignetteEncoding{UTF-8}
---

During the 2025 US Measles outbreak, the number of cases in the state of Utah started to climb quickly in the southwest region of the state. This vignette shows how we can use the mixing model of the `measles` R package to do scenario modeling of the situation using both age and school data.

## Set up

We start by loading the `measles` R package. Since the package depends on [`epiworldR`](https://cran.r-project.org/package=epiworldR){target="_blank"}, `epiworldR` is loaded automatically too:

```{r}
#| label: load
library(measles)
```

For the data, we need two datasets: information about the population distribution by age and vaccination status, and the contact matrix. The `measles` R package comes with a pre-processed dataset that was created using the [`multigroup.vaccine` R package](https://github.com/EpiForeSITE/multigroup-vaccine). We can load the needed data using the `data()` function:

```{r}
#| label: data
data(southwest_utah, package = "measles")
data(southwest_utah_matrix, package = "measles")
```

Let's take a look at the datasets:

```{r}
#| label: data-peek
southwest_utah

# Looking at the first 5 columns
southwest_utah_matrix[, 1:5] |>
  round(2)
```

One important thing to note is that the data in `southwest_utah` must conincide with that in the contact matrix, particularly, there should be one entry in the `data.frame` for each row/column of the contact matrix.

## Creating the model

To create the model, we do the following:

```{r}
#| label: create-model
N <- sum(southwest_utah$agepops)

measles_model <- ModelMeaslesMixing(
  n                        = N,
  prevalence               = 1 / N,
  contact_rate             = 15,
  transmission_rate        = 0.9,
  vax_efficacy             = 0.97,
  vax_reduction_recovery_rate = 0.8,
  incubation_period        = 10,
  prodromal_period         = 3,
  rash_period              = 7,
  contact_matrix           = southwest_utah_matrix,
  hospitalization_rate     = 0.1,
  hospitalization_period   = 10,
  days_undetected          = 2,
  quarantine_period        = 14,
  quarantine_willingness   = 0.9,
  isolation_willingness    = 0.8,
  isolation_period         = 10,
  prop_vaccinated          = 0.95,
  contact_tracing_success_rate = 0.8,
  contact_tracing_days_prior = 4
)

# Adding the entities to the model
entities_from_dataframe(
  model = measles_model,
  entities = southwest_utah,
  col_name = "age_labels",
  col_number = "agepops",
  as_proportion = FALSE
)

set.seed(331)
run(measles_model, ndays = 100)
summary(measles_model)
```
